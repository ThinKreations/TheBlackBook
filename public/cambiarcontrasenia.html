<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="styles/main.css" rel="stylesheet">
    <link href="styles/home-module.css" rel="stylesheet">
    <link href="styles/app-module.css" rel="stylesheet">
    <title>Cambio de Contrase√±a</title>
    
</head>
<body>
    <div class="container">
        <h1>üîí Cambio de Contrase√±a</h1>
        
        <div id="alertBox" class="alert"></div>

        <form id="passwordForm">
            <div class="form-group">
                <label for="currentPassword">Contrase√±a Actual *</label>
                <div class="input-wrapper">
                    <input type="password" id="currentPassword" required>
                    <span class="toggle-password" onclick="togglePassword('currentPassword')">üëÅÔ∏è</span>
                </div>
            </div>

            <div class="form-group">
                <label for="newPassword">Nueva Contrase√±a *</label>
                <div class="input-wrapper">
                    <input type="password" id="newPassword" required>
                    <span class="toggle-password" onclick="togglePassword('newPassword')">üëÅÔ∏è</span>
                </div>
                <div class="requirement" id="lengthRequirement">
                    ‚ö†Ô∏è Debe contener al menos 8 caracteres
                </div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirmar Nueva Contrase√±a *</label>
                <div class="input-wrapper">
                    <input type="password" id="confirmPassword" required>
                    <span class="toggle-password" onclick="togglePassword('confirmPassword')">üëÅÔ∏è</span>
                </div>
            </div>

            <button type="submit">Cambiar Contrase√±a</button>
        </form>
    </div>

    <script>
        let storedPassword = localStorage.getItem('password');

        const form = document.getElementById('passwordForm');
        const alertBox = document.getElementById('alertBox');
        const currentPasswordInput = document.getElementById('currentPassword');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const lengthRequirement = document.getElementById('lengthRequirement');

        newPasswordInput.addEventListener('input', function() {
            if (this.value.length >= 8) {
                lengthRequirement.textContent = '‚úì Cumple con el requisito de 8 caracteres';
                lengthRequirement.className = 'requirement valid';
            } else {
                lengthRequirement.textContent = '‚ö†Ô∏è Debe contener al menos 8 caracteres';
                lengthRequirement.className = 'requirement invalid';
            }
        });

        function showAlert(message, type) {
            alertBox.textContent = message;
            alertBox.className = `alert alert-${type} show`;
            
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }

        function clearFields(startFrom) {
            if (startFrom === 'all') {
                currentPasswordInput.value = '';
                newPasswordInput.value = '';
                confirmPasswordInput.value = '';
            } else if (startFrom === 'new') {
                newPasswordInput.value = '';
                confirmPasswordInput.value = '';
            }
        }

        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            if (field.type === 'password') {
                field.type = 'text';
            } else {
                field.type = 'password';
            }
        }

        // Manejador del formulario
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const currentPassword = currentPasswordInput.value;
            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (currentPassword !== storedPassword) {
                showAlert('‚ùå La contrase√±a actual no es correcta. Por favor, int√©ntalo nuevamente.', 'error');
                clearFields('all');
                currentPasswordInput.focus();
                return;
            }

            if (newPassword.length < 8) {
                showAlert('‚ùå La nueva contrase√±a debe contener al menos 8 caracteres.', 'error');
                clearFields('new');
                newPasswordInput.focus();
                return;
            }

            // Paso 6: Validar que la nueva contrase√±a y la confirmaci√≥n sean iguales
            if (newPassword !== confirmPassword) {
                // Paso 6.2: Alertamiento de contrase√±as incorrectas
                showAlert('‚ùå Las contrase√±as nuevas no coinciden. Por favor, verifica e int√©ntalo nuevamente.', 'error');
                // Paso 6.3: Volver a intentar desde el paso 4
                clearFields('new');
                newPasswordInput.focus();
                return;
            }

            // Paso 7: Proceder con el cambio de contrase√±a
            storedPassword = newPassword;

            // Paso 8: Desplegar leyenda de cambio exitoso
            showAlert('‚úÖ ¬°Cambio de contrase√±a exitoso! Tu contrase√±a ha sido actualizada.', 'success');
            
            // Limpiar todos los campos
            clearFields('all');
        });
    </script>
</body>
</html>